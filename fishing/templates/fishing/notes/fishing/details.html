{% extends 'fishing/base.html' %}
{% load static %}
{% load verbose_names %}
{% load len_element %}
{% load element_by_key %}
{% block content %}

<table>
  <tr>
    <td colspan="2">
      <strong>{% get_verbose_field_name fishing "date" %}:</strong> {{ fishing.date }} 
      {% if fishing.planned %}
        (запланировано)
      {% endif %}
    </td>
  </tr>
  <tr>
    <td>
      <strong>{% get_verbose_field_name fishing "time_start" %}:</strong> {{ fishing.time_start }}
    </td>
    <td>
      <strong>{% get_verbose_field_name fishing "time_end" %}:</strong> {{ fishing.time_end }}
    </td>
  </tr>
</table>

<table>
  <tr>
    <td colspan="6">
      <strong>Место проведения рыбалки:</strong>
      {% if fishing.fishingplace_set.get %}
      <a href="{% url 'fishing:fishing_place_select' fishing.id %}"><img class="button__img" src="{% static 'images/edit.png' %}" alt="Edit"></a>
      <a href="{% url 'fishing:fishing_place_delete' fishing.id fishing.fishingplace_set.get.id %}"><img class="button__img" src="{% static 'images/delete.png' %}" alt="Delete"></a>
      {% else %}
      <a href="{% url 'fishing:fishing_place_select' fishing.id %}"><img class="button__img" src="{% static 'images/add.png' %}" alt=""></a>
      {% endif %}
    </td>
  </tr>

  {% if fishing.fishingplace_set.get %}
  <tr>
    <td>
      <strong>{% get_verbose_field_name fishing.fishingplace_set.get.place "water" %}: </strong>{{ fishing.fishingplace_set.get.place.water }}</td>
    {% if fishing.fishingplace_set.get.place.locality %}
    <td>
      <strong>{% get_verbose_field_name fishing.fishingplace_set.get.place "locality" %}: </strong>{{ fishing.fishingplace_set.get.place.locality }}
    </td>
    {% endif %}
    {% if fishing.fishingplace_set.get.place.name %}
    <td>
      <strong>{% get_verbose_field_name fishing.fishingplace_set.get.place "name" %}: </strong>{{ fishing.fishingplace_set.get.place.name }}
    </td>
    {% endif %}
  </tr>
  {% endif %}
</table>

<table>
  <tr>
    <td colspan="3">
      <strong>Погода во время рыбалки:</strong>
      {% if fishing.fishingweather_set.get %}
        <a href="{% url 'fishing:fishing_weather_edit' fishing.id fishing.fishingweather_set.get.id %}"><img class="button__img" src="{% static 'images/edit.png' %}" alt="Edit"></a>
        <a href="{% url 'fishing:fishing_weather_delete' fishing.id fishing.fishingweather_set.get.id %}"><img class="button__img" src="{% static 'images/delete.png' %}" alt="Delete"></a>
      {% else %}
        <a href="{% url 'fishing:fishing_weather_add' fishing.id %}"><img class="button__img" src="{% static 'images/add.png' %}" alt=""></a>
      {% endif %}
    </td>
  </tr>

  {% if fishing.fishingweather_set.get %}
  <tr>
    {% if fishing.fishingweather_set.get.weather.overcast %}
      <td>
        <strong>{% get_verbose_field_name fishing.fishingweather_set.get.weather "overcast" %}: </strong>
        {{ fishing.fishingweather_set.get.weather.overcast }}
      </td>
    {% endif %}
    {% if fishing.fishingweather_set.get.weather.temperature %}
      <td>
        <strong>{% get_verbose_field_name fishing.fishingweather_set.get.weather "temperature" %}: </strong>
        {{ fishing.fishingweather_set.get.weather.temperature }}
        &deg
      </td>
    {% endif %}
    {% if fishing.fishingweather_set.get.weather.conditions %}
      <td>
        <strong>{% get_verbose_field_name fishing.fishingweather_set.get.weather "conditions" %}: </strong>
        {{ fishing.fishingweather_set.get.weather.conditions }}
      </td>
    {% endif %}
  </tr>
  <tr>
    {% if fishing.fishingweather_set.get.weather.pressure %}
      <td>
        <strong>{% get_verbose_field_name fishing.fishingweather_set.get.weather "pressure" %}: </strong>
        {{ fishing.fishingweather_set.get.weather.pressure }}
        мм.рт.ст.
      </td>
    {% endif %}
    {% if fishing.fishingweather_set.get.weather.direction_wind %}
      <td>
        <strong>{% get_verbose_field_name fishing.fishingweather_set.get.weather "direction_wind" %}: </strong>
        {{ fishing.fishingweather_set.get.weather.direction_wind }}
      </td>
    {% endif %}
    {% if fishing.fishingweather_set.get.weather.wind_speed %}
      <td>
        <strong>{% get_verbose_field_name fishing.fishingweather_set.get.weather "wind_speed" %}: </strong>
        {{ fishing.fishingweather_set.get.weather.wind_speed }}
        м/с
      </td>
    {% endif %}
  </tr>
  {% endif %}
</table>

<table>
  <thead>
    <tr>
      <th  style="text-align: center; border: 0; width: 10%;">Снасти:</th>
      <th>Монтажи:</th>
      <th>Кормушки:</th>
      <th>Поводки:</th>
      <th>Крючки:</th>
      <th>Наживки:</th>
      <th>Темп:</th>
    </tr>
  </thead>
  {% for fishing_tackle in fishing.fishingtackle_set.all %}
    <tr>
      <td>
        {% if fishing_tackle.tackle.manufacturer %}
          <p><strong>Производитель: </strong>
          {{ fishing_tackle.tackle.manufacturer }}</p>
        {% endif %}
        {% if fishing_tackle.tackle.model_tackle %}
          <p><strong>Модель: </strong>
          {{ fishing_tackle.tackle.model_tackle }}</p>
        {% endif %}
        {% if fishing_tackle.tackle.length %}
          <p><strong>Длина: </strong>
          {{ fishing_tackle.tackle.length }}</p>
        {% endif %}
        {% if fishing_tackle.tackle.casting_weight %}
          <p><strong>Тест: </strong>
            {{ fishing_tackle.tackle.casting_weight }} гр.</p>
        {% endif %}
      </td>
      <td>
        {{ fishing_tackle.fishingmontage_set.get.montage }}
      </td>
      <td>
        {% if fishing_tackle.fishingtrough_set.get.trough.manufacturer %}
          <p><strong>Производитель :</strong>
          {{ fishing_tackle.fishingtrough_set.get.trough.manufacturer }}</p>
        {% endif %}
        {% if fishing_tackle.fishingtrough_set.get.trough.model_name %}
          <p><strong>Модель :</strong>
          {{ fishing_tackle.fishingtrough_set.get.trough.model_name }}</p>
        {% endif %}
        {% if fishing_tackle.fishingtrough_set.get.trough.plastic %}
          <p><strong>Материал: </strong>Пластик</p>
        {% endif %}
        {% if fishing_tackle.fishingtrough_set.get.trough.lugs %}
          <p><strong>Грунтозацепы: </strong>да</p>
        {% endif %}
        {% if fishing_tackle.fishingtrough_set.get.trough.feed_capacity %}
          <p><strong>Кормоёмкость: </strong>
          {{fishing_tackle.fishingtrough_set.get.trough.feed_capacity }}</p>
        {% endif %}
        {% if fishing_tackle.fishingtrough_set.get.trough.weight %}
          <p><strong>Вес: </strong>
          {{ fishing_tackle.fishingtrough_set.get.trough.weight }}</p>
        {% endif %}
      </td>
      <td>
        {% if fishing_tackle.fishingleash_set.get %}
          {% if fishing_tackle.fishingleash_set.get.leash.material %}
            <p><strong>Материал: </strong>
            {{ fishing_tackle.fishingleash_set.get.leash.material }}</p>
          {% endif %}
          {% if fishing_tackle.fishingleash_set.get.leash.diameter %}
            <p><strong>Диаметр: </strong>
            {{ fishing_tackle.fishingleash_set.get.leash.diameter }} мм.</p>
          {% endif %}
          {% if fishing_tackle.fishingleash_set.get.leash.length %}
            <p><strong>Длина: </strong>
            {{ fishing_tackle.fishingleash_set.get.leash.length }} см.</p>
          {% endif %}
        {% endif %}
      </td>
      <td>
        {% if fishing_tackle.fishingcrochet_set.get %}
          {% if fishing_tackle.fishingcrochet_set.get.crochet.manufacturer %}
            <p><strong>Производитель: </strong>
            {{ fishing_tackle.fishingcrochet_set.get.crochet.manufacturer }}</p>
          {% endif %}
          {% if fishing_tackle.fishingcrochet_set.get.crochet.model %}
            <p><strong>Модель: </strong>
            {{ fishing_tackle.fishingcrochet_set.get.crochet.model }}</p>
          {% endif %}
          {% if fishing_tackle.fishingcrochet_set.get.crochet.size %}
            <p><strong>Размер: </strong>
            {{ fishing_tackle.fishingcrochet_set.get.crochet.size }}</p>
          {% endif %}
        {% endif %}
      </td>
      <td>
        {% if fishing_tackle.fishingnozzle_set.get %}
          {% if fishing_tackle.fishingnozzle_set.get.nozzle_base.bait %}
            {% if fishing_tackle.fishingnozzle_set.get.nozzle_base.name %}
              <p>{{ fishing_tackle.fishingnozzle_set.get.nozzle_base.name }}</p>
            {% endif %}
            {% if fishing_tackle.fishingnozzle_set.get.nozzle_base.manufacturer %}
              <p><strong>Производитель: </strong>
              {{ fishing_tackle.fishingnozzle_set.get.nozzle_base.manufacturer }}</p>
            {% endif %}
          {% else %}
            {% if fishing_tackle.fishingnozzle_set.get.nozzle_base.manufacturer %}
              <p><strong>Производитель: </strong>
              {{ fishing_tackle.fishingnozzle_set.get.nozzle_base.manufacturer }}</p>
            {% endif %}
            {% if fishing_tackle.fishingnozzle_set.get.nozzle_base.name %}
              <p><strong>Название: </strong>
              {{ fishing_tackle.fishingnozzle_set.get.nozzle_base.name }}</p>
            {% endif %}
            {% if fishing_tackle.fishingnozzle_set.get.nozzle_base.size %}
              <p><strong>Диаметр насадки: </strong>
              {{ fishing_tackle.fishingnozzle_set.get.nozzle_base.size }}</p>
            {% endif %}
            {% if fishing_tackle.fishingnozzle_set.get.nozzle_base.ntype %}
              <p><strong>Тип насадки: </strong>
              {{ fishing_tackle.fishingnozzle_set.get.nozzle_base.ntype }}</p>
            {% endif %}
          {% endif %}
        {% endif %}
      </td>
      <td>
        {{ fishing_tackle.fishingpace_set.get.pace }}
      </td>
    </tr>
    <tr>
      <td>
        <a href="{% url 'fishing:fishing_tackle_select' fishing.id fishing_tackle.id %}"><img class="button__img" src="{% static 'images/edit.png' %}" alt="Edit"></a>
        <a href="{% url 'fishing:fishing_tackle_delete' fishing.id fishing_tackle.id %}"><img class="button__img" src="{% static 'images/delete.png' %}" alt="Delete"></a>
      </td>
      <td>
        {% if fishing_tackle.fishingmontage_set.get %}
          <a href="{% url 'fishing:fishing_montage_select' fishing.id fishing_tackle.id fishing_tackle.fishingmontage_set.get.id %}"><img class="button__img" src="{% static 'images/edit.png' %}" alt="Edit"></a>
          <a href="{% url 'fishing:fishing_montage_delete' fishing.id fishing_tackle.fishingmontage_set.get.id %}"><img class="button__img" src="{% static 'images/delete.png' %}" alt="Delete"></a>
        {% else %}
          <a href="{% url 'fishing:fishing_montage_select' fishing.id fishing_tackle.id 0 %}"><img class="button__img" src="{% static 'images/add.png' %}" alt=""></a>
        {% endif %}
      </td>
      <td>
        {% if fishing_tackle.fishingtrough_set.get %}
          <a href="{% url 'fishing:fishing_trough_select' fishing.id fishing_tackle.id fishing_tackle.fishingtrough_set.get.id %}"><img class="button__img" src="{% static 'images/edit.png' %}" alt="Edit"></a>
          <a href="{% url 'fishing:fishing_trough_delete' fishing.id fishing_tackle.fishingtrough_set.get.id %}"><img class="button__img" src="{% static 'images/delete.png' %}" alt="Delete"></a>
        {% else %}
          <a href="{% url 'fishing:fishing_trough_select' fishing.id fishing_tackle.id 0 %}"><img class="button__img" src="{% static 'images/add.png' %}" alt=""></a>
        {% endif %}
      </td>
      <td>
        {% if fishing_tackle.fishingleash_set.get %}
          <a href="{% url 'fishing:fishing_leash_select' fishing.id fishing_tackle.id fishing_tackle.fishingleash_set.get.id %}"><img class="button__img" src="{% static 'images/edit.png' %}" alt="Edit"></a>
          <a href="{% url 'fishing:fishing_leash_delete' fishing.id fishing_tackle.fishingleash_set.get.id %}"><img class="button__img" src="{% static 'images/delete.png' %}" alt="Delete"></a>
        {% else %}
          <a href="{% url 'fishing:fishing_leash_select' fishing.id fishing_tackle.id 0 %}"><img class="button__img" src="{% static 'images/add.png' %}" alt=""></a>
        {% endif %}
      </td>
      <td>
        {% if fishing_tackle.fishingcrochet_set.get %}
          <a href="{% url 'fishing:fishing_crochet_select' fishing.id fishing_tackle.id fishing_tackle.fishingcrochet_set.get.id %}"><img class="button__img" src="{% static 'images/edit.png' %}" alt="Edit"></a>
          <a href="{% url 'fishing:fishing_crochet_delete' fishing.id fishing_tackle.fishingcrochet_set.get.id %}"><img class="button__img" src="{% static 'images/delete.png' %}" alt="Delete"></a>
        {% else %}
          <a href="{% url 'fishing:fishing_crochet_select' fishing.id fishing_tackle.id 0 %}"><img class="button__img" src="{% static 'images/add.png' %}" alt=""></a>
        {% endif %}
      </td>
      <td>
        {% if fishing_tackle.fishingnozzle_set.get %}
          <a href="{% url 'fishing:fishing_nozzle_select' fishing.id fishing_tackle.id fishing_tackle.fishingnozzle_set.get.id %}"><img class="button__img" src="{% static 'images/edit.png' %}" alt="Edit"></a>
          <a href="{% url 'fishing:fishing_nozzle_delete' fishing.id fishing_tackle.fishingnozzle_set.get.id %}"><img class="button__img" src="{% static 'images/delete.png' %}" alt="Delete"></a>
        {% else %}
          <a href="{% url 'fishing:fishing_nozzle_select' fishing.id fishing_tackle.id 0 %}"><img class="button__img" src="{% static 'images/add.png' %}" alt=""></a>
        {% endif %}
      </td>
      <td>
        {% if fishing_tackle.fishingpace_set.get %}
          <a href="{% url 'fishing:fishing_pace_select' fishing.id fishing_tackle.id fishing_tackle.fishingpace_set.get.id %}" ><img class="button__img" src="{% static 'images/edit.png' %}" alt="Edit"></a>
          <a href="{% url 'fishing:fishing_pace_delete' fishing.id fishing_tackle.fishingpace_set.get.id %}"><img class="button__img" src="{% static 'images/delete.png' %}" alt="Delete"></a>
        {% else %}
          <a href="{% url 'fishing:fishing_pace_select' fishing.id fishing_tackle.id 0 %}"><img class="button__img" src="{% static 'images/add.png' %}" alt=""></a>
        {% endif %}
      </td>
    </tr>
  {% endfor %}
  <tr>
    <td>
      <a href="{% url 'fishing:fishing_tackle_select' fishing.id 0 %}"><img class="button__img" src="{% static 'images/add.png' %}" alt=""></a>
    </td>
  </tr>
</table>

<table>
  <tr>
    <td>
      {% if fishing.fishingluremix_set.get %}
        <strong>Прикормочная смесь: </strong>
        {{ fishing.fishingluremix_set.get.lure_mix.name }}
        <a href="{% url 'fishing:fishing_lure_mix_select' fishing.id %}">
          <img class="button__img" src="{% static 'images/edit.png' %}" alt="Edit">
        </a>
        <a href="{% url 'fishing:fishing_lure_mix_delete' fishing.id %}">
          <img class="button__img" src="{% static 'images/delete.png' %}" alt="Delete">
        </a>
      {% else %}
        {% if fishing.fishinglure_set.get %}
          <strong>Прикорм:</strong>
          <a href="{% url 'fishing:fishing_lure_change_weight' fishing.id fishing.fishinglure_set.get.lure_base.id fishing.fishinglure_set.get.id %}">
            <img class="button__img" src="{% static 'images/edit.png' %}" alt="Edit">
          </a>
          <a href="{% url 'fishing:fishing_lure_delete' fishing.id fishing.fishinglure_set.get.id %}">
            <img class="button__img" src="{% static 'images/delete.png' %}" alt="Delete">
          </a>
        {% else %}
          <a href="{% url 'fishing:fishing_lure_mix_select' fishing.id %}">
            <img class="button__img" src="{% static 'images/add.png' %}" alt="">Указать смесь
          </a>
          <a href="{% url 'fishing:fishing_lure_select' fishing.id %}">
            <img class="button__img" src="{% static 'images/add.png' %}" alt="">Указать прикорм
          </a>
        {% endif %}
      {% endif %}
    </td>
  </tr>
  {% if fishing.fishingluremix_set.get or fishing.fishinglure_set.get %}
  {% if fishing.fishingluremix_set.get %}
      {% if fishing.fishingluremix_set.get.lure_mix.lure_set %}
        <tr>
          <td>
            <strong>Прикормы:</strong>
          </td>
        </tr>
        <tr>
          <table>
            <tr>
              {% for lure in fishing.fishingluremix_set.get.lure_mix.lure_set.all %}
              <td>
                {% if lure.base.manufacturer %}
                  <p><strong>Производитель: </strong>
                  {{ lure.base.manufacturer }}</p>
                {% endif %}
                {% if lure.base.name %}
                  <p><strong>Название: </strong>
                  {{ lure.base.name }}</p>
                {% endif %}
                {% if lure.weight %}
                  <p><strong>Доля прикорма: </strong>{{ lure.weight }}</p>
                {% endif %}
              </td>
              {% endfor %}
            </tr>
          </table>
        </tr>
      {% endif %}
      {% if fishing.fishingluremix_set.get.lure_mix.aroma_set %}
        <tr>
          <td>
            <strong>Аромы:</strong>
          </td>
        </tr>
        <tr>
          <table>
            <tr>
              {% for aroma in fishing.fishingluremix_set.get.lure_mix.aroma_set.all %}
                <td>
                  {% if aroma.base.manufacturer %}
                    <p><strong>Производитель: </strong>
                    {{ aroma.base.manufacturer }}</p>
                  {% endif %}
                  {% if aroma.base.name %}
                    <p><strong>Название: </strong>
                    {{ aroma.base.name }}</p>
                  {% endif %}
                  {% if aroma.volume %}
                    <p><strong>Объем аромы: </strong>
                    {{ aroma.volume }} л.</p>
                  {% endif %}
                </td>
              {% endfor %}
            </tr>
          </table>
        </tr>
      {% endif %}
      {% if fishing.fishingluremix_set.get.lure_mix.nozzle_set %}
      <tr>
        <td>
          <p><strong>Добавки в состав:</strong></p>
        </td>
      </tr>
      <tr>
        <table>
          <tr>
            {% for nozzle in fishing.fishingluremix_set.get.lure_mix.nozzle_set.all %}
              <td>
                {% if nozzle.base.manufacturer %}
                  <p><strong>Производитель: </strong>
                  {{ nozzle.base.manufacturer }}</p>
                {% endif %}
                {% if nozzle.base.name %}
                  <p><strong>Название: </strong>
                  {{ nozzle.base.name }}</p>
                {% endif %}
                {% if nozzle.state.state %}
                  <p><strong>Состояние: </strong>
                  {{ nozzle.state.state }}</p>
                {% endif %}
              </td>
            {% endfor %}
          </tr>
        </table>
      </tr>
      {% endif %}
    {% else %}
      <tr>
        <td>
          <p><strong>Прикорм</strong></p>
          {% if fishing.fishinglure_set.get.lure_base.manufacturer %}
            <p><strong>Производитель: </strong>
            {{ fishing.fishinglure_set.get.lure_base.manufacturer }}</p>
          {% endif %}
          {% if fishing.fishinglure_set.get.lure_base.name %}
            <p><strong>Название: </strong>
            {{ fishing.fishinglure_set.get.lure_base.name }}</p>
          {% endif %}
          {% if fishing.fishinglure_set.get.weight %}
            <p><strong>Доля прикорма: </strong>
            {{ fishing.fishinglure_set.get.weight }}</p>
          {% endif %}
        </td>
      </tr>
    {% endif %}
  {% endif %}
</table>

    
    <p><strong>Улов:</strong><a href="{% url 'fishing:fishing_result_add' fishing.id %}"><img class="button__img" src="{% static 'images/add.png' %}" alt="Add"></a></p>
    {% for fishing_result in fishing.fishingresult_set.all %}
    <p>
        {{ forloop.counter }}. 
        {% if fishing_result.target %}
          <img class="content__img" src="{% static 'images/target.png' %}" alt="Целевая" title="Целевая рыба">
        {% endif %}
        {{ fishing_result.fish }}:
        {{ fishing_result.number_of_fish }} шт.
        {% if fishing_result.fish_weight %}
        общим весом:
        {{ fishing_result.fish_weight }} кг.
        {% endif %}
        <a href="{% url 'fishing:fishing_result_edit' fishing.id fishing_result.id %}"><img class="button__img" src="{% static 'images/edit.png' %}" alt="Edit"></a>
        <a href="{% url 'fishing:fishing_result_delete' fishing.id fishing_result.id %}"><img class="button__img" src="{% static 'images/delete.png' %}" alt="Delete"></a>
    </p>
    {% endfor %}
    
    
    <p><strong>Трофеи:</strong><a href="{% url 'fishing:fish_trophy_add' fishing.id %}"><img class="button__img" src="{% static 'images/add.png' %}" alt="Add"></a></p>
    {% for key_element in fishing_trophy|get_len %}
      <p>
        {{ forloop.counter }}.
        {% if fishing_trophy.target|get_element:key_element %}
          <img class="content__img" src="{% static 'images/target.png' %}" alt="Целевая" title="Целевая рыба">
        {% endif %}
        {{fishing_trophy.fish|get_element:key_element}}: вес трофея
        {{fishing_trophy.weight|get_element:key_element}} кг.
      </p>
    {% endfor %}

    <div class="content__item-text">
      <p>
        <strong>{% get_verbose_field_name fishing "note" %}</strong>
        <a href="{% url 'fishing:fishing_note' fishing.id %}"><img class="button__img" src="{% static 'images/edit.png' %}" alt="Edit"></a>
      </p>
      {% if fishing.note %}
        <p>
          {{ fishing.note}}
        </p>
      {% endif %}
    </div>

    <div class="content__item-text">
      <p>Отчет: 
        {% if fishing_report_settings %}
          <input type="url" hidden id="id_text_to_copy_{{fishing.id}}" value="{{ fishing.report }}">
          <button class="button__img" onclick="copyToClipboard('id_text_to_copy_{{fishing.id}}')">
            <img class="button__img" src="{% static 'images/copy.png' %}" alt="Copy">
          </button>
          <a href="{% url 'fishing:fishing_report_settings' fishing.id %}">
            <img class="button__img" src="{% static 'images/edit.png' %}" alt="Edit">
          </a>
          <a href="{% url 'fishing:fishing_report_settings_delete' fishing.id %}">
            <img class="button__img" src="{% static 'images/delete.png' %}" alt="Delete">
          </a>
        {% else %}
          <a href="{% url 'fishing:fishing_report_settings' fishing.id %}">
            <img class="button__img" src="{% static 'images/add.png' %}" alt="Add">
          </a>
        {% endif %}

      </p>

    </div>
    <div class="content__item content__item--btn-position">
      <a class="button__std" href="{% url 'fishing:fishing' %}">Назад</a>
    </div>
{% endblock %}
